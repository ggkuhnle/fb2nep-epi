<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1.04 – Data Collection and Cleaning – FB2NEP Nutritional Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
</head><body class="nav-sidebar floating nav-fixed"><img src="https://kuhnle.co.uk/pixel.png" width="1" height="1" style="display:none" alt="">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>





<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">FB2NEP Nutritional Epidemiology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assessment/index.html"> 
<span class="menu-text">Assessment</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">1.04 – Data Collection and Cleaning</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FB2NEP — Nutritional Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">notebooks/*.ipynb</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Sandbox</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../howto_sandbox/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FB2NEP — How‑To &amp; Sandbox (Colab/Jupyter)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#variable-types-and-coding" id="toc-variable-types-and-coding" class="nav-link active" data-scroll-target="#variable-types-and-coding"><span class="header-section-number">1</span> 1. Variable types and coding</a>
  <ul class="collapse">
  <li><a href="#uk-socio-economic-status-ses-classification-a-short-guide" id="toc-uk-socio-economic-status-ses-classification-a-short-guide" class="nav-link" data-scroll-target="#uk-socio-economic-status-ses-classification-a-short-guide"><span class="header-section-number">1.1</span> UK Socio-Economic Status (SES) Classification – A Short Guide</a></li>
  <li><a href="#excursion-index-of-multiple-deprivation-imd" id="toc-excursion-index-of-multiple-deprivation-imd" class="nav-link" data-scroll-target="#excursion-index-of-multiple-deprivation-imd"><span class="header-section-number">1.2</span> Excursion: Index of Multiple Deprivation (IMD)</a></li>
  <li><a href="#excursion-physical-activity-why-categories-are-vague-and-why-it-matters" id="toc-excursion-physical-activity-why-categories-are-vague-and-why-it-matters" class="nav-link" data-scroll-target="#excursion-physical-activity-why-categories-are-vague-and-why-it-matters"><span class="header-section-number">1.3</span> Excursion: Physical Activity – Why Categories Are Vague (and Why It Matters)</a></li>
  <li><a href="#how-we-should-use-different-types" id="toc-how-we-should-use-different-types" class="nav-link" data-scroll-target="#how-we-should-use-different-types"><span class="header-section-number">1.4</span> 1.3 How we (should) use different types</a></li>
  <li><a href="#simple-validation-example-smoking-and-cvd" id="toc-simple-validation-example-smoking-and-cvd" class="nav-link" data-scroll-target="#simple-validation-example-smoking-and-cvd"><span class="header-section-number">1.5</span> 1.4 Simple validation example: smoking and CVD</a></li>
  <li><a href="#making-ordinal-variables-explicit-in-the-data" id="toc-making-ordinal-variables-explicit-in-the-data" class="nav-link" data-scroll-target="#making-ordinal-variables-explicit-in-the-data"><span class="header-section-number">1.6</span> 1.5 Making ordinal variables explicit in the data</a></li>
  </ul></li>
  <li><a href="#data-collection-pipelines" id="toc-data-collection-pipelines" class="nav-link" data-scroll-target="#data-collection-pipelines"><span class="header-section-number">2</span> 2. Data collection pipelines</a>
  <ul class="collapse">
  <li><a href="#units-and-harmonisation" id="toc-units-and-harmonisation" class="nav-link" data-scroll-target="#units-and-harmonisation"><span class="header-section-number">2.1</span> 2.1 Units and harmonisation</a></li>
  </ul></li>
  <li><a href="#coding-and-information-loss" id="toc-coding-and-information-loss" class="nav-link" data-scroll-target="#coding-and-information-loss"><span class="header-section-number">3</span> 3. Coding and information loss</a>
  <ul class="collapse">
  <li><a href="#example-collapsing-continuous-bmi-into-categories" id="toc-example-collapsing-continuous-bmi-into-categories" class="nav-link" data-scroll-target="#example-collapsing-continuous-bmi-into-categories"><span class="header-section-number">3.1</span> 3.1 Example: collapsing continuous BMI into categories</a></li>
  <li><a href="#ethnic-specific-bmi-thresholds-for-equivalent-diabetes-risk" id="toc-ethnic-specific-bmi-thresholds-for-equivalent-diabetes-risk" class="nav-link" data-scroll-target="#ethnic-specific-bmi-thresholds-for-equivalent-diabetes-risk"><span class="header-section-number">3.2</span> Ethnic-specific BMI thresholds for equivalent diabetes risk</a></li>
  </ul></li>
  <li><a href="#identifying-implausible-or-inconsistent-values" id="toc-identifying-implausible-or-inconsistent-values" class="nav-link" data-scroll-target="#identifying-implausible-or-inconsistent-values"><span class="header-section-number">4</span> 4. Identifying implausible or inconsistent values</a>
  <ul class="collapse">
  <li><a href="#energy-intake-plausibility-and-the-goldberg-cut-off" id="toc-energy-intake-plausibility-and-the-goldberg-cut-off" class="nav-link" data-scroll-target="#energy-intake-plausibility-and-the-goldberg-cut-off"><span class="header-section-number">4.1</span> 4.4 Energy Intake Plausibility and the Goldberg Cut-off</a></li>
  <li><a href="#limitations-of-the-goldberg-cut-off" id="toc-limitations-of-the-goldberg-cut-off" class="nav-link" data-scroll-target="#limitations-of-the-goldberg-cut-off"><span class="header-section-number">4.2</span> 4.5 Limitations of the Goldberg Cut-off</a></li>
  <li><a href="#recent-evidence-and-critique" id="toc-recent-evidence-and-critique" class="nav-link" data-scroll-target="#recent-evidence-and-critique"><span class="header-section-number">4.3</span> 4.6 Recent evidence and critique</a></li>
  <li><a href="#takeaway-2" id="toc-takeaway-2" class="nav-link" data-scroll-target="#takeaway-2"><span class="header-section-number">4.4</span> Takeaway</a></li>
  </ul></li>
  <li><a href="#plausibility-and-scale-hippo-vs-mouse-energy-intake" id="toc-plausibility-and-scale-hippo-vs-mouse-energy-intake" class="nav-link" data-scroll-target="#plausibility-and-scale-hippo-vs-mouse-energy-intake"><span class="header-section-number">5</span> 4.5 Plausibility and scale: hippo vs mouse energy intake</a></li>
  <li><a href="#rare-categories-and-prefer-not-to-say" id="toc-rare-categories-and-prefer-not-to-say" class="nav-link" data-scroll-target="#rare-categories-and-prefer-not-to-say"><span class="header-section-number">6</span> 5. Rare categories and “Prefer not to say”</a>
  <ul class="collapse">
  <li><a href="#test-questions-and-internal-consistency" id="toc-test-questions-and-internal-consistency" class="nav-link" data-scroll-target="#test-questions-and-internal-consistency"><span class="header-section-number">6.1</span> 5.1 Test questions and internal consistency</a></li>
  </ul></li>
  <li><a href="#missing-data-mcar-mar-mnar-overview" id="toc-missing-data-mcar-mar-mnar-overview" class="nav-link" data-scroll-target="#missing-data-mcar-mar-mnar-overview"><span class="header-section-number">7</span> 6. Missing data: MCAR, MAR, MNAR (overview)</a></li>
  <li><a href="#simple-validation-checks" id="toc-simple-validation-checks" class="nav-link" data-scroll-target="#simple-validation-checks"><span class="header-section-number">8</span> 7. Simple validation checks</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">9</span> 8. Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ggkuhnle/fb2nep-epi/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ggkuhnle/fb2nep-epi/blob/main/notebooks/1.04_data_collection_cleaning.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">1.04 – Data Collection and Cleaning</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Version 0.1.0</p>
<p>This workbook introduces:</p>
<ul>
<li>Data collection pipelines in nutritional epidemiology.</li>
<li>Types of variables (continuous, categorical, ordinal, count) and how we code them.</li>
<li>Identification of implausible or inconsistent values.</li>
<li>Handling missing data (MCAR, MAR, MNAR – overview).</li>
<li>Simple validation and visual checks.</li>
<li>Practical issues such as “prefer not to say”, test questions, and units.</li>
</ul>
<p>Run the first code cell to set up the repository and load the dataset.</p>
<div id="bootstrap-cell" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># FB2NEP bootstrap cell (works both locally and in Colab)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># What this cell does:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - Ensures that we are inside the fb2nep-epi repository.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - In Colab: clones the repository from GitHub if necessary.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - Loads and runs scripts/bootstrap.py.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - Makes the main dataset available as the variable `df`.</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Important:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># - You may see messages printed below (for example from pip</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   or from the bootstrap script). This is expected.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - You may also see WARNINGS (often in yellow). In most cases</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   these are harmless and can be ignored for this module.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># - The main thing to watch for is a red error traceback</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   (for example FileNotFoundError, ModuleNotFoundError).</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   If that happens, please re-run this cell first. If the</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   error persists, ask for help.</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib.util</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration: repository location and URL</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># REPO_URL: address of the GitHub repository.</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># REPO_DIR: folder name that will be created when cloning.</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>REPO_URL <span class="op">=</span> <span class="st">"https://github.com/ggkuhnle/fb2nep-epi.git"</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>REPO_DIR <span class="op">=</span> <span class="st">"fb2nep-epi"</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Ensure we are inside the fb2nep-epi repository</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># In local Jupyter, you may already be inside the repository,</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># for example in fb2nep-epi/notebooks.</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># In Colab, the default working directory is /content, so</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># we need to clone the repository into /content/fb2nep-epi</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># and then change into that folder.</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>cwd <span class="op">=</span> pathlib.Path.cwd()</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Case A: we are already in the repository (scripts/bootstrap.py exists here)</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (cwd <span class="op">/</span> <span class="st">"scripts"</span> <span class="op">/</span> <span class="st">"bootstrap.py"</span>).is_file():</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    repo_root <span class="op">=</span> cwd</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Case B: we are outside the repository (for example in Colab)</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    repo_root <span class="op">=</span> cwd <span class="op">/</span> REPO_DIR</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clone the repository if it is not present yet</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> repo_root.is_dir():</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Cloning repository from </span><span class="sc">{</span>REPO_URL<span class="sc">}</span><span class="ss"> into </span><span class="sc">{</span>repo_root<span class="sc">}</span><span class="ss"> ..."</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        subprocess.run([<span class="st">"git"</span>, <span class="st">"clone"</span>, REPO_URL, <span class="bu">str</span>(repo_root)], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Using existing repository at </span><span class="sc">{</span>repo_root<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Change the working directory to the repository root</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    os.chdir(repo_root)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    repo_root <span class="op">=</span> pathlib.Path.cwd()</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Repository root set to: </span><span class="sc">{</span>repo_root<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Load scripts/bootstrap.py as a module and call init()</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co"># The shared bootstrap script contains all logic to:</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co"># - Ensure that required Python packages are installed.</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co"># - Ensure that the synthetic dataset exists (and generate it</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   if needed).</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="co"># - Load the dataset into a pandas DataFrame.</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="co"># We load the script as a normal Python module (fb2nep_bootstrap)</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="co"># and then call its init() function.</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>bootstrap_path <span class="op">=</span> repo_root <span class="op">/</span> <span class="st">"scripts"</span> <span class="op">/</span> <span class="st">"bootstrap.py"</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> bootstrap_path.is_file():</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Could not find </span><span class="sc">{</span>bootstrap_path<span class="sc">}</span><span class="ss">. "</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Please check that the fb2nep-epi repository structure is intact."</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a module specification from the file</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>spec <span class="op">=</span> importlib.util.spec_from_file_location(<span class="st">"fb2nep_bootstrap"</span>, bootstrap_path)</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>bootstrap <span class="op">=</span> importlib.util.module_from_spec(spec)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>sys.modules[<span class="st">"fb2nep_bootstrap"</span>] <span class="op">=</span> bootstrap</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute the bootstrap script in the context of this module</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>spec.loader.exec_module(bootstrap)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co"># The init() function is defined in scripts/bootstrap.py.</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co"># It returns:</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="co"># - df   : the main synthetic cohort as a pandas DataFrame.</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="co"># - CTX  : a small context object with paths, flags and settings.</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>df, CTX <span class="op">=</span> bootstrap.init()</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally expose a few additional useful variables from the</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap module (if they exist). These are not essential for</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="co"># most analyses, but can be helpful for advanced use.</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> [<span class="st">"CSV_REL"</span>, <span class="st">"REPO_NAME"</span>, <span class="st">"REPO_URL"</span>, <span class="st">"IN_COLAB"</span>]:</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(bootstrap, name):</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">globals</span>()[name] <span class="op">=</span> <span class="bu">getattr</span>(bootstrap, name)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Bootstrap completed successfully."</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The main dataset is available as the variable `df`."</span>)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The context object is available as `CTX`."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="variable-types-and-coding" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="variable-types-and-coding"><span class="header-section-number">1</span> 1. Variable types and coding</h2>
<p>Before we think about <em>where</em> data come from, we need to understand <em>what kind of things</em> we can measure.</p>
<p>In this workbook we will repeatedly use three broad types of variables:</p>
<ul>
<li><p><strong>Continuous variables</strong><br>
Numeric measurements on a (more or less) continuous scale.<br>
Examples: <code>BMI</code>, <code>SBP</code>, <code>energy_kcal</code>, <code>fruit_veg_g_d</code>.</p></li>
<li><p><strong>Categorical variables (nominal)</strong><br>
Categories without an inherent order.<br>
Examples: <code>sex</code>, <code>SES_class</code>, <code>smoking_status</code>.</p></li>
<li><p><strong>Ordinal variables</strong><br>
Categories with a meaningful order, but without fixed distances between levels.<br>
Examples: <code>IMD_quintile</code> (1 = most deprived, 5 = least deprived), <code>physical_activity</code> (<code>low</code> / <code>moderate</code> / <code>high</code>).</p></li>
</ul>
<p>Later, in the workbook on sampling and representativeness, we will use these variable types to compare our synthetic FB2NEP cohort to reference surveys (such as NHANES). Here we focus on:</p>
<ul>
<li>how different types of variables are <strong>stored</strong> and <strong>summarised</strong> in Python,<br>
</li>
<li>what happens when we <strong>encode</strong> answers into numbers, and<br>
</li>
<li>how we can already spot some problems just from the way data are coded.</li>
</ul>
<section id="uk-socio-economic-status-ses-classification-a-short-guide" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="uk-socio-economic-status-ses-classification-a-short-guide"><span class="header-section-number">1.1</span> UK Socio-Economic Status (SES) Classification – A Short Guide</h3>
<p>In UK public health and survey research, socio-economic status is often measured using the <strong>NRS Social Grades</strong>.<br>
(NRS: National Readership Survey) They are widely used in national surveys, market research, and sometimes in epidemiology.</p>
<section id="the-six-nrs-social-grades" class="level4" data-number="1.1.1">
<h4 data-number="1.1.1" class="anchored" data-anchor-id="the-six-nrs-social-grades"><span class="header-section-number">1.1.1</span> 1. The Six NRS Social Grades</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 43%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Grade</th>
<th>Meaning</th>
<th>Typical occupations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>A</strong></td>
<td>Higher managerial, administrative, professional</td>
<td>CEOs, senior civil servants</td>
</tr>
<tr class="even">
<td><strong>B</strong></td>
<td>Intermediate managerial, administrative, professional</td>
<td>Teachers, mid-level managers, engineers</td>
</tr>
<tr class="odd">
<td><strong>C1</strong></td>
<td>Supervisory, clerical, junior managerial/professional</td>
<td>Office staff, technicians</td>
</tr>
<tr class="even">
<td><strong>C2</strong></td>
<td>Skilled manual workers</td>
<td>Electricians, plumbers, carpenters</td>
</tr>
<tr class="odd">
<td><strong>D</strong></td>
<td>Semi-skilled &amp; unskilled manual workers</td>
<td>Factory workers, delivery drivers</td>
</tr>
<tr class="even">
<td><strong>E</strong></td>
<td>Casual/lowest-grade workers, unemployed, pensioners</td>
<td>Long-term unemployed, some retirees</td>
</tr>
</tbody>
</table>
<p>These grades correlate with income, education, and job security — but they are not identical to any one of those.</p>
</section>
<section id="the-two-level-system-abc1-vs-c2de" class="level4" data-number="1.1.2">
<h4 data-number="1.1.2" class="anchored" data-anchor-id="the-two-level-system-abc1-vs-c2de"><span class="header-section-number">1.1.2</span> 2. The Two-Level System: ABC1 vs C2DE</h4>
<p>Many surveys collapse the six groups into two wider bands:</p>
<ul>
<li><strong>ABC1</strong>: higher or intermediate SES (A + B + C1)<br>
</li>
<li><strong>C2DE</strong>: lower SES (C2 + D + E)</li>
</ul>
<p>This simplified classification is the one used in the FB2NEP synthetic dataset (<code>SES_class</code>).</p>
</section>
<section id="strengths-and-limitations" class="level4" data-number="1.1.3">
<h4 data-number="1.1.3" class="anchored" data-anchor-id="strengths-and-limitations"><span class="header-section-number">1.1.3</span> 3. Strengths and Limitations</h4>
<p><strong>Strengths</strong> - Simple, widely recognised, consistently used in UK surveys. - Shows clear associations with health behaviours and outcomes.</p>
<p><strong>Limitations</strong> - Coarse: mixes diverse occupations within broad categories. - Not portable outside the UK (occupation structures differ). - Based on <em>occupation</em>, which is awkward for students, retirees, carers, and precarious workers. - Does not map neatly to education or income.</p>
</section>
<section id="harmonisation-issues-across-datasets-education-income-occupation" class="level4" data-number="1.1.4">
<h4 data-number="1.1.4" class="anchored" data-anchor-id="harmonisation-issues-across-datasets-education-income-occupation"><span class="header-section-number">1.1.4</span> 4. Harmonisation Issues Across Datasets (Education, Income, Occupation)</h4>
<p>SES looks deceptively simple, but different datasets measure <strong>different things</strong>:</p>
<ul>
<li><strong>NHANES (US)</strong> uses <em>education</em> (≤ high school / some college / college+).</li>
<li><strong>NDNS (UK)</strong> often uses education or income <em>alongside</em> NRS social grade.</li>
<li><strong>EPIC</strong> and <strong>UK Biobank</strong> use mixtures of <em>occupation</em>, <em>education</em>, <em>income</em>, <em>area-level deprivation</em>.</li>
<li><strong>FB2NEP</strong> uses <em>occupation-based social grades</em> (ABC1 / C2DE).</li>
<li><strong>International surveys</strong> (OECD, WHO STEPS, Eurostat) usually use education because occupation and income do not translate across countries.</li>
</ul>
<p>This immediately creates problems for harmonisation.</p>
<section id="why-ses-education-income-occupation" class="level5" data-number="1.1.4.1">
<h5 data-number="1.1.4.1" class="anchored" data-anchor-id="why-ses-education-income-occupation"><span class="header-section-number">1.1.4.1</span> Why SES ≠ education ≠ income ≠ occupation</h5>
<p>SES is a <strong>latent construct</strong> — an underlying social position that cannot be measured directly.<br>
Different operationalisations capture different aspects:</p>
<ul>
<li><strong>Education</strong> → long-term human capital, cognitive resources, health literacy.<br>
</li>
<li><strong>Income</strong> → current material resources and capacity to purchase goods.<br>
</li>
<li><strong>Occupation</strong> → job security, working conditions, prestige, social capital.<br>
</li>
<li><strong>Area-level deprivation</strong> → neighbourhood environment, access to services.</li>
</ul>
<p>These correlate, but not perfectly.<br>
&gt; Example: a highly educated PhD student may have low income; a long-serving electrician may earn more than a junior academic but be coded as C2, not ABC1.</p>
<p>Using one variable to stand in for SES always loses information.</p>
</section>
<section id="why-the-uk-is-unusual" class="level5" data-number="1.1.4.2">
<h5 data-number="1.1.4.2" class="anchored" data-anchor-id="why-the-uk-is-unusual"><span class="header-section-number">1.1.4.2</span> Why the UK is unusual</h5>
<p>The UK has a long-standing, highly standardised <strong>occupation-based SES system</strong>:</p>
<ul>
<li><strong>NRS Social Grades (A–E)</strong>, created for media and market research, became widely used in public health research.</li>
<li>It maps occupation → social class → purchasing power in a historically industrial society.</li>
<li>It remains deeply embedded in UK survey infrastructure (ONS, NDNS, IPSOS, BBC, etc.).</li>
</ul>
<p>This is unusual internationally:</p>
<ul>
<li>Most countries <strong>do not</strong> have a national occupation-based SES scale.</li>
<li>Education is the default SES variable in the US, EU, and WHO datasets because it is the most stable and portable across contexts.</li>
<li>Occupations, job structures and prestige systems differ too much between countries to harmonise consistently.</li>
</ul>
<p>Thus, using ABC1/C2DE outside the UK is difficult.</p>
</section>
<section id="what-happens-when-two-ses-systems-must-be-aligned" class="level5" data-number="1.1.4.3">
<h5 data-number="1.1.4.3" class="anchored" data-anchor-id="what-happens-when-two-ses-systems-must-be-aligned"><span class="header-section-number">1.1.4.3</span> What happens when two SES systems must be aligned?</h5>
<p>Any harmonisation requires <strong>strong assumptions</strong>.<br>
Typical problems:</p>
<ul>
<li><strong>Different constructs</strong>: NHANES education ≠ UK NRS grades.<br>
</li>
<li><strong>Different number of categories</strong>: one is binary (ABC1/C2DE), one has three or six categories.<br>
</li>
<li><strong>Different conceptual meaning</strong>: “College+” is not equivalent to “professional/managerial”.<br>
</li>
<li><strong>Non-monotonic relationships</strong>: more education ≠ higher job grade in every case.</li>
</ul>
<p>Example mismatches: - A retired senior civil servant → NRS A/B but education may be “≤ High school”. - A university graduate in a temporary low-paid job → college+ + C2 or D. - A tradesperson with high income → C2 but with higher income than many ABC1 workers.</p>
</section>
<section id="implications-for-analysis" class="level5" data-number="1.1.4.4">
<h5 data-number="1.1.4.4" class="anchored" data-anchor-id="implications-for-analysis"><span class="header-section-number">1.1.4.4</span> Implications for analysis</h5>
<p>Harmonisation is always an approximation.<br>
When aligning SES across datasets:</p>
<ul>
<li><strong>Be explicit</strong> about the mapping rules you apply.<br>
</li>
<li><strong>Check frequencies</strong> and identify categories that map poorly.<br>
</li>
<li><strong>Document data loss</strong> (e.g.&nbsp;collapsing categories removes nuance).<br>
</li>
<li><strong>Acknowledge uncertainty</strong> introduced by any recoding.<br>
</li>
<li><strong>Perform sensitivity analyses</strong> where possible (e.g., different mapping schemes).</li>
</ul>
<p>Teaching takeaway:<br>
<em>SES is a theoretical construct, not a variable.<br>
Every dataset measures it differently.<br>
Harmonisation therefore requires judgement, transparency, and a clear statement of limitations.</em></p>
</section>
</section>
<section id="takeaway" class="level4" data-number="1.1.5">
<h4 data-number="1.1.5" class="anchored" data-anchor-id="takeaway"><span class="header-section-number">1.1.5</span> 5. Takeaway</h4>
<p>SES is not a single “true” attribute.<br>
Different countries, surveys and traditions measure it differently.<br>
For cross-dataset comparisons (e.g.&nbsp;NHANES vs FB2NEP), SES must be <strong>translated</strong> with care and the uncertainties should be stated clearly.</p>
</section>
</section>
<section id="excursion-index-of-multiple-deprivation-imd" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="excursion-index-of-multiple-deprivation-imd"><span class="header-section-number">1.2</span> Excursion: Index of Multiple Deprivation (IMD)</h3>
<p><strong>Index of Multiple Deprivation (IMD)</strong> is the main <em>area-based</em> measure of deprivation used in England.<br>
It does <strong>not</strong> describe an individual’s SES, but the <strong>deprivation level of the small area</strong> where they live.</p>
<hr>
<section id="what-imd-measures" class="level5" data-number="1.2.0.1">
<h5 data-number="1.2.0.1" class="anchored" data-anchor-id="what-imd-measures"><span class="header-section-number">1.2.0.1</span> 1. What IMD measures</h5>
<p>IMD combines <strong>seven domains</strong> of deprivation into a single index:</p>
<ol type="1">
<li><strong>Income</strong><br>
</li>
<li><strong>Employment</strong><br>
</li>
<li><strong>Education, skills and training</strong><br>
</li>
<li><strong>Health and disability</strong><br>
</li>
<li><strong>Crime</strong><br>
</li>
<li><strong>Barriers to housing and services</strong><br>
</li>
<li><strong>Living environment</strong></li>
</ol>
<p>Each small area (Lower Layer Super Output Area, LSOA; ~1,500 people) receives:</p>
<ul>
<li>a <strong>rank</strong> (1 = most deprived area in England),<br>
</li>
<li>and derived <strong>deciles</strong> or <strong>quintiles</strong>.</li>
</ul>
<p>In FB2NEP we use <strong>IMD quintiles</strong>, where:</p>
<ul>
<li><strong>1 = most deprived</strong>,<br>
</li>
<li><strong>5 = least deprived</strong>.</li>
</ul>
<hr>
</section>
<section id="imd-vs-individual-ses" class="level5" data-number="1.2.0.2">
<h5 data-number="1.2.0.2" class="anchored" data-anchor-id="imd-vs-individual-ses"><span class="header-section-number">1.2.0.2</span> 2. IMD vs individual SES</h5>
<p>IMD is <strong>area-level</strong>; SES (such as NRS social grade or education) is usually <strong>individual-level</strong>.</p>
<p>They capture related but different aspects:</p>
<ul>
<li>IMD reflects the <strong>context</strong> of a neighbourhood<br>
(local income, employment, environment, access to services, crime).<br>
</li>
<li>SES reflects an individual’s <strong>social position</strong><br>
(education, occupation, income, security).</li>
</ul>
<p>Examples:</p>
<ul>
<li>A highly educated person may live in an IMD 1 area (cheap housing in a deprived neighbourhood).<br>
</li>
<li>A low-income person may live in an IMD 4–5 area (long-term tenant in a relatively affluent area).</li>
</ul>
<p><strong>Key point:</strong> IMD is very useful for understanding <strong>health inequalities and neighbourhood effects</strong>,<br>
but it must not be treated as “the same thing” as individual SES.</p>
<hr>
</section>
<section id="why-imd-appears-in-fb2nep" class="level5" data-number="1.2.0.3">
<h5 data-number="1.2.0.3" class="anchored" data-anchor-id="why-imd-appears-in-fb2nep"><span class="header-section-number">1.2.0.3</span> 3. Why IMD appears in FB2NEP</h5>
<p>Many UK cohort studies and surveys (e.g.&nbsp;NDNS, UK Biobank, some cancer registries) link IMD to participants via postcode.<br>
Typical uses include:</p>
<ul>
<li>describing the <strong>deprivation profile</strong> of the cohort,<br>
</li>
<li>studying <strong>gradients</strong> in risk factors and disease by area-level deprivation,<br>
</li>
<li>adjusting for area-level deprivation as a potential <strong>confounder</strong>.</li>
</ul>
<p>FB2NEP mirrors this practice by including <code>IMD_quintile</code>:</p>
<ul>
<li>It lets us explore <strong>inequalities</strong> in diet and health,<br>
</li>
<li>and it sets up later Public Health exercises where IMD plays a central role.</li>
</ul>
<hr>
</section>
<section id="practical-reminders-for-analysis" class="level5" data-number="1.2.0.4">
<h5 data-number="1.2.0.4" class="anchored" data-anchor-id="practical-reminders-for-analysis"><span class="header-section-number">1.2.0.4</span> 4. Practical reminders for analysis</h5>
<ul>
<li>Treat IMD as an <strong>ordered categorical</strong> variable (e.g.&nbsp;quintiles), not as a precise continuous scale.<br>
</li>
<li>Be clear in write-ups that IMD is <strong>area-based</strong>, not a personal SES measure.<br>
</li>
<li>Consider showing results by <strong>both</strong> individual SES (e.g.&nbsp;ABC1/C2DE) <strong>and</strong> IMD where possible.</li>
</ul>
</section>
</section>
<section id="excursion-physical-activity-why-categories-are-vague-and-why-it-matters" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="excursion-physical-activity-why-categories-are-vague-and-why-it-matters"><span class="header-section-number">1.3</span> Excursion: Physical Activity – Why Categories Are Vague (and Why It Matters)</h3>
<p>Physical activity is <strong>essential</strong> in nutritional epidemiology, yet it is one of the <strong>least precisely measured</strong> variables in any dataset.<br>
Even “good” surveys struggle because <em>activity is multi-dimensional</em> and hard to summarise in a single score.</p>
<hr>
<section id="why-physical-activity-is-hard-to-measure" class="level5" data-number="1.3.0.1">
<h5 data-number="1.3.0.1" class="anchored" data-anchor-id="why-physical-activity-is-hard-to-measure"><span class="header-section-number">1.3.0.1</span> 1. Why physical activity is hard to measure</h5>
<p>Physical activity varies by:</p>
<ul>
<li><strong>Intensity</strong> (light, moderate, vigorous)<br>
</li>
<li><strong>Type</strong> (walking, cycling, work-related, leisure, sport, chores)<br>
</li>
<li><strong>Duration</strong><br>
</li>
<li><strong>Frequency</strong><br>
</li>
<li><strong>Context</strong> (commuting, occupation, exercise, childcare)</li>
</ul>
<p>This creates an enormous range of behaviours that cannot easily be captured by simple categories.</p>
<hr>
</section>
<section id="how-surveys-measure-activity" class="level5" data-number="1.3.0.2">
<h5 data-number="1.3.0.2" class="anchored" data-anchor-id="how-surveys-measure-activity"><span class="header-section-number">1.3.0.2</span> 2. How surveys measure activity</h5>
<p>Most population studies rely on <strong>self-report</strong>, for example:</p>
<ul>
<li>“How many minutes per week of moderate physical activity do you do?”<br>
</li>
<li>“How often do you walk for at least 10 minutes?”<br>
</li>
<li>“How active is your job?”<br>
</li>
<li>Likert scales such as <em>low / moderate / high</em>.</li>
</ul>
<p>More detailed instruments exist (IPAQ, GPAQ), but they still rely on participant recall and judgement.<br>
Even objectively measured PA (accelerometers, wearables) must be <strong>translated into categories</strong>, and the choice of cut-points affects results.</p>
<hr>
</section>
<section id="what-fb2nep-uses-and-why" class="level5" data-number="1.3.0.3">
<h5 data-number="1.3.0.3" class="anchored" data-anchor-id="what-fb2nep-uses-and-why"><span class="header-section-number">1.3.0.3</span> 3. What FB2NEP uses (and why)</h5>
<p>FB2NEP includes a variable:</p>
<ul>
<li><strong><code>physical_activity</code></strong> = <code>"low"</code>, <code>"moderate"</code>, <code>"high"</code></li>
</ul>
<p>This is typical in cohort studies where detailed accelerometer data are not available.</p>
<p>However, these categories are:</p>
<ul>
<li><strong>Vague</strong>: “moderate” for one person may be “vigorous” for another.<br>
</li>
<li><strong>Self-assessed</strong>: depends on how active participants <em>feel</em>.<br>
</li>
<li><strong>Context-dependent</strong>: a manual worker and a sedentary office worker with the same walking minutes may not classify themselves the same way.</li>
</ul>
<p>In other words:<br>
&gt; <em>These categories provide a rough indicator of activity level, useful for broad comparisons but not precise enough to infer true energy expenditure.</em></p>
<hr>
</section>
<section id="common-problems-in-analysis" class="level5" data-number="1.3.0.4">
<h5 data-number="1.3.0.4" class="anchored" data-anchor-id="common-problems-in-analysis"><span class="header-section-number">1.3.0.4</span> 4. Common problems in analysis</h5>
<ol type="1">
<li><p><strong>Non-comparability across surveys</strong></p>
<ul>
<li>NHANES uses MET-minutes.<br>
</li>
<li>NDNS uses questionnaire-based categorisation.<br>
</li>
<li>UK Biobank uses a mixture (IPAQ-like questions + accelerometer subsample).<br>
</li>
<li>EPIC uses a 4-level Cambridge index.</li>
</ul>
<p>These systems are <strong>not equivalent</strong>.</p></li>
<li><p><strong>Categorisation introduces information loss</strong></p>
<ul>
<li>Collapsing minutes, intensity, and context into one label removes detail.<br>
</li>
<li>“Moderate” may hide large differences in actual activity.</li>
</ul></li>
<li><p><strong>Cut-off sensitivity</strong></p>
<ul>
<li>If “moderate” is defined differently across studies, results are not directly comparable.</li>
</ul></li>
<li><p><strong>Residual confounding</strong></p>
<ul>
<li>PA categories are too crude to fully capture lifestyle differences<br>
(e.g.&nbsp;fitness, occupation, active commuting).</li>
</ul></li>
</ol>
<hr>
</section>
<section id="why-this-matters-for-nutritional-epidemiology" class="level5" data-number="1.3.0.5">
<h5 data-number="1.3.0.5" class="anchored" data-anchor-id="why-this-matters-for-nutritional-epidemiology"><span class="header-section-number">1.3.0.5</span> 5. Why this matters for nutritional epidemiology</h5>
<p>Physical activity is a major confounder for:</p>
<ul>
<li>Energy intake<br>
</li>
<li>Obesity<br>
</li>
<li>Cardiovascular risk<br>
</li>
<li>Metabolic markers<br>
</li>
<li>Sedentary behaviour<br>
</li>
<li>Diet–disease associations</li>
</ul>
<p>Using crude PA categories increases <strong>measurement error</strong>, which tends to:</p>
<ul>
<li><strong>Bias effect estimates toward the null</strong>,<br>
</li>
<li><strong>Inflate residual confounding</strong>,<br>
</li>
<li>Make PA look “less important” than it is.</li>
</ul>
<hr>
</section>
<section id="takeaway-1" class="level5" data-number="1.3.0.6">
<h5 data-number="1.3.0.6" class="anchored" data-anchor-id="takeaway-1"><span class="header-section-number">1.3.0.6</span> 6. Takeaway</h5>
<ul>
<li>Physical activity categories are <strong>useful</strong>, but <strong>imprecise</strong>.<br>
</li>
<li>Never over-interpret “low/moderate/high” as exact physiological measures.<br>
</li>
<li>When comparing datasets, check how PA was measured and consider harmonisation issues.<br>
</li>
<li>If possible, perform <strong>sensitivity analyses</strong> using alternative cut-points.</li>
</ul>
<div id="quick-look-types" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.1 Quick look at the synthetic cohort and variable types</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the first 5 rows</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>display(df.head())</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the data types of the first few columns</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>df.dtypes.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="var-type-summaries" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2 Examples of how we summarise different variable types</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Continuous example: BMI</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"BMI"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"BMI – continuous variable"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    display(df[<span class="st">"BMI"</span>].describe())</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical example: sex</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"sex"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">sex – categorical (nominal)"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df[<span class="st">"sex"</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordinal example: IMD_quintile</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"IMD_quintile"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">IMD_quintile – stored as numbers, but conceptually ordered categories"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df[<span class="st">"IMD_quintile"</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>).sort_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="how-we-should-use-different-types" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="how-we-should-use-different-types"><span class="header-section-number">1.4</span> 1.3 How we (should) use different types</h3>
<ul>
<li><p>For <strong>continuous variables</strong> we normally use summaries such as <em>mean</em>, <em>standard deviation</em>, histograms, boxplots, and regression models with the variable on its original scale.</p></li>
<li><p>For <strong>categorical variables</strong> we usually use <em>counts</em> and <em>proportions</em>, and cross-tabulations (contingency tables), for example <code>smoking_status × CVD_incident</code>.</p></li>
<li><p>For <strong>ordinal variables</strong>, we technically have two options:</p>
<ol type="1">
<li><p><strong>Treat them as ordered categories</strong><br>
(e.g.&nbsp;proportional-odds models, cumulative logit models, or ordered bar charts).<br>
This respects the fact that the categories have an order <em>but not a measurable distance</em>.</p></li>
<li><p><strong>Code them as 0/1/2/3 and analyse them as if they were continuous</strong><br>
(e.g.&nbsp;using them in linear regression).</p></li>
</ol>
<p>⚠️ <strong>This second option is risky</strong> because it quietly assumes:</p>
<ul>
<li>the “gap” between <em>low → moderate</em> is the same size as <em>moderate → high</em>;<br>
</li>
<li>and that those distances are meaningful on a numeric scale.</li>
</ul>
<p>These assumptions are almost never justified.</p>
<p>Treating ordinal scales as continuous can:</p>
<ul>
<li>distort effect sizes,<br>
</li>
<li>produce misleading trends,<br>
</li>
<li>violate model assumptions,<br>
</li>
<li>and give regression coefficients that look precise but have no real-world meaning.</li>
</ul>
<blockquote class="blockquote">
<p><em>It works by accident, not by principle.</em></p>
</blockquote></li>
</ul>
<p><strong>Best practice:</strong><br>
Use ordinal models when possible; if you collapse the scale to treat it as continuous, justify it clearly and perform sensitivity checks.</p>
<p>For this module we keep a simple rule of thumb:</p>
<blockquote class="blockquote">
<p>Ordinal variables are <em>not automatically</em> continuous.<br>
If you code them as numbers, you must still think about whether treating “low → moderate → high” as evenly spaced is sensible for your question.</p>
</blockquote>
</section>
<section id="simple-validation-example-smoking-and-cvd" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="simple-validation-example-smoking-and-cvd"><span class="header-section-number">1.5</span> 1.4 Simple validation example: smoking and CVD</h3>
<p>As a quick <strong>sanity check</strong>, we can look at how often incident cardiovascular disease (CVD) occurs in different <strong>smoking categories</strong>.</p>
<ul>
<li><code>smoking_status</code> is a <strong>categorical exposure</strong> (for example, never / former / current).</li>
<li><code>CVD_incident</code> is a <strong>binary outcome</strong> (0 = no event, 1 = event).</li>
</ul>
<p>A natural question is:</p>
<blockquote class="blockquote">
<p><em>“Is incident CVD more common in some smoking groups than others?”</em></p>
</blockquote>
<p>To explore this, we can use <code>pandas.crosstab</code> with <code>normalize="index"</code>:</p>
<ul>
<li>Each <strong>row</strong> corresponds to one smoking category.</li>
<li>Each <strong>cell</strong> is the <strong>proportion</strong> of participants in that smoking group with / without incident CVD.</li>
<li>Rows therefore sum to 1 (100%).</li>
</ul>
<p>This does <strong>not</strong> prove causality, and it ignores confounders (for example, age, sex, SES),<br>
but it is a very useful descriptive check:</p>
<ul>
<li>Does the pattern roughly match what we expect (higher CVD in current smokers than never smokers)?<br>
</li>
<li>Are there any obviously strange values (for example, zero events in a large group)?</li>
</ul>
<p>In the next cell we compute and display this row-normalised cross-tabulation.</p>
<div id="contingency-example" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> {<span class="st">"smoking_status"</span>, <span class="st">"CVD_incident"</span>}.issubset(df.columns):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    tab <span class="op">=</span> pd.crosstab(df[<span class="st">"smoking_status"</span>], df[<span class="st">"CVD_incident"</span>], normalize<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Proportion with incident CVD by smoking status:"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    display(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="making-ordinal-variables-explicit-in-the-data" class="level3" data-number="1.6">
<h3 data-number="1.6" class="anchored" data-anchor-id="making-ordinal-variables-explicit-in-the-data"><span class="header-section-number">1.6</span> 1.5 Making ordinal variables explicit in the data</h3>
<p>Some variables in <code>df</code> are <strong>inherently ordered</strong>, even though they are stored as numbers or plain strings:</p>
<ul>
<li><code>IMD_quintile</code>: 1 (most deprived) → 5 (least deprived).<br>
</li>
<li><code>physical_activity</code>: <code>"low"</code> → <code>"moderate"</code> → <code>"high"</code>.</li>
</ul>
<p>If we leave them as ordinary integers/strings, pandas and most modelling functions will treat them either as:</p>
<ul>
<li><strong>purely categorical</strong> (no order at all), or<br>
</li>
<li><strong>continuous</strong> (for example, using 1–5 as if the gaps were equal).</li>
</ul>
<p>Both can be misleading:</p>
<ul>
<li>Treating them as <strong>unordered categories</strong> throws away the ranking information.<br>
</li>
<li>Treating them as <strong>continuous</strong> quietly assumes that the “distance” from 1→2 is the same as 4→5, which is rarely justified.</li>
</ul>
<p>A better approach is to mark them explicitly as <strong>ordered categorical variables</strong>.<br>
This preserves the ranking (1 &lt; 2 &lt; … &lt; 5; low &lt; moderate &lt; high) without pretending that the gaps are equal.</p>
<p>In the next cell we:</p>
<ul>
<li>create <code>IMD_quintile_ord</code> and <code>physical_activity_ord</code> as ordered <code>Categorical</code> variables;<br>
</li>
<li>keep the original columns so you can see both side by side.</li>
</ul>
<p>Later, when we model these variables, we can use methods appropriate for ordered data (for example, ordered bar plots, stratified summaries, or proportional-odds models), rather than treating them as plain numbers.</p>
<div id="ord-categorical-example" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"IMD_quintile"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"IMD_quintile_ord"</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"IMD_quintile"</span>],</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>],</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        ordered<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"physical_activity"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"physical_activity_ord"</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"physical_activity"</span>],</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>],</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        ordered<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>cols_to_show <span class="op">=</span> [</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    c <span class="cf">for</span> c <span class="kw">in</span> [<span class="st">"IMD_quintile"</span>, <span class="st">"IMD_quintile_ord"</span>, <span class="st">"physical_activity"</span>, <span class="st">"physical_activity_ord"</span>]</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> df.columns</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cols_to_show:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    display(df[cols_to_show].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-collection-pipelines" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="data-collection-pipelines"><span class="header-section-number">2</span> 2. Data collection pipelines</h2>
<p>In nutritional epidemiology, data usually come from several sources that are linked together:</p>
<ul>
<li><strong>Questionnaires and interviews</strong> (for example, food frequency questionnaires, 24-hour recalls, lifestyle questionnaires).</li>
<li><strong>Laboratory measurements</strong> (for example, blood biomarkers, urinary biomarkers).</li>
<li><strong>Clinical examinations</strong> (for example, blood pressure, anthropometry).</li>
<li><strong>Registers and administrative data</strong> (for example, hospital episode statistics, cancer registries, mortality data).</li>
<li><strong>Public datasets and surveys</strong> (for example, NHANES in the United States, NDNS in the United Kingdom).</li>
</ul>
<p>Typical steps in a data collection pipeline are:</p>
<ol type="1">
<li><strong>Sampling and recruitment</strong> of participants.</li>
<li><strong>Baseline data collection</strong>:
<ul>
<li>Questionnaires completed on paper, online, or via interview.</li>
<li>Clinical and anthropometric measurements.</li>
<li>Biospecimen collection for later laboratory analysis.</li>
</ul></li>
<li><strong>Follow-up data collection</strong>:
<ul>
<li>Repeat questionnaires or clinic visits.</li>
<li>Linkage to health registers to obtain information on disease outcomes.</li>
</ul></li>
<li><strong>Data entry, coding and merging</strong>:
<ul>
<li>Scanning or manual entry of questionnaires.</li>
<li>Coding of free-text responses.</li>
<li>Merging laboratory, questionnaire and register data using a unique participant identifier.</li>
</ul></li>
</ol>
<p>The synthetic FB2NEP dataset represents a <strong>merged cohort</strong> where these steps have already taken place. The underlying logic, however, is the same as in real-world studies such as NHANES or NDNS.</p>
<section id="units-and-harmonisation" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="units-and-harmonisation"><span class="header-section-number">2.1</span> 2.1 Units and harmonisation</h3>
<p>When combining or comparing datasets, we must pay attention to <strong>units</strong> and <strong>coding schemes</strong>:</p>
<ul>
<li>Blood lipids: mmol/L (UK, Europe) vs mg/dL (US).</li>
<li>Height: centimetres vs inches.</li>
<li>Education and SES: different qualification systems across countries.</li>
<li>Physical activity: self-reported categories vs device-based measures.</li>
</ul>
<p>Before merging or comparing datasets we should always check:</p>
<ol type="1">
<li>Units and reference ranges (for example, SBP in mmHg vs kPa).<br>
</li>
<li>Coding manuals for questionnaires (for example, education categories).<br>
</li>
<li>Whether local scores (for example, deprivation indices) are comparable at all.</li>
</ol>
<p>In later workbooks, when we compare FB2NEP to NHANES or NDNS, we will see that harmonisation sometimes requires judgement and inevitably involves some information loss.</p>
</section>
</section>
<section id="coding-and-information-loss" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="coding-and-information-loss"><span class="header-section-number">3</span> 3. Coding and information loss</h2>
<p>When we turn real-world phenomena into variables, we always <strong>lose information</strong> – long before we fit any models.</p>
<p>Examples:</p>
<ul>
<li>Turning height and weight into <strong>BMI</strong> loses information about body shape.<br>
Two people with very different height and weight can have the <em>same</em> BMI.</li>
<li>Turning continuous BMI into three categories (for example, <em>normal / overweight / obese</em>) throws away all variation <strong>within</strong> each band.</li>
<li>Turning detailed income into a few SES categories (<code>ABC1</code> vs <code>C2DE</code>) hides differences <em>within</em> each broad class.</li>
</ul>
<p>Why do we code and collapse variables?</p>
<blockquote class="blockquote">
<p><em>Coding</em> refers to the systematic assignment of numerical or categorical codes to raw data values (e.g., converting BMI into obesity categories such as 0 = underweight, 1 = normal, 2 = overweight, 3 = obese) to facilitate statistical analysis, grouping, or modelling.</p>
</blockquote>
<ul>
<li>To shorten questionnaires.</li>
<li>To make models simpler and more stable.</li>
<li>To produce tables that fit on one slide or in a paper.</li>
</ul>
<p>The trade-off is:</p>
<blockquote class="blockquote">
<p>More coding and categorisation → simpler communication,<br>
but <strong>less information</strong> and sometimes <strong>more bias</strong>.</p>
</blockquote>
<p>In practice, we should:</p>
<ul>
<li>keep the <strong>rawest sensible version</strong> of each variable;</li>
<li>document every coding step;</li>
<li>think about what has been <strong>lost</strong> at each stage.</li>
</ul>
<section id="example-collapsing-continuous-bmi-into-categories" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="example-collapsing-continuous-bmi-into-categories"><span class="header-section-number">3.1</span> 3.1 Example: collapsing continuous BMI into categories</h3>
<p>BMI itself is already a <strong>derived</strong> measure:</p>
<ul>
<li>It combines <em>height</em> and <em>weight</em> into a single number (<code>kg/m²</code>);</li>
<li>It does <strong>not</strong> distinguish between muscle and fat mass;</li>
<li>It treats all people with the same BMI as equivalent, even if their body composition is very different.</li>
</ul>
<p>On top of that, we often <strong>categorise</strong> BMI:</p>
<ul>
<li>“normal weight”, “overweight”, “obese”, sometimes with more bands;</li>
<li>convenient for guidelines and tables;</li>
<li>but it discards differences within each band<br>
(for example, BMI 30.1 vs 39.9 are both just “obese”).</li>
</ul>
<blockquote class="blockquote">
<p><strong>Please note</strong><br>
BMI cut-off points associated with metabolic risk differ across ethnic groups.<br>
Several populations develop type 2 diabetes at <strong>lower BMI</strong> than White populations.</p>
</blockquote>
</section>
<section id="ethnic-specific-bmi-thresholds-for-equivalent-diabetes-risk" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="ethnic-specific-bmi-thresholds-for-equivalent-diabetes-risk"><span class="header-section-number">3.2</span> Ethnic-specific BMI thresholds for equivalent diabetes risk</h3>
<p>Using a cohort of 1.47 million adults in England, Caleyachetty et al.&nbsp;(2021) compared the<br>
BMI level at which different ethnic groups have the <strong>same age- and sex-adjusted incidence</strong><br>
of type 2 diabetes as White adults at <strong>BMI 30 kg/m²</strong>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 67%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Ethnic group</th>
<th>BMI associated with equivalent diabetes risk</th>
<th>95% CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>White</strong></td>
<td>30.0 kg/m² (reference)</td>
<td>–</td>
</tr>
<tr class="even">
<td><strong>South Asian</strong></td>
<td><strong>23.9 kg/m²</strong></td>
<td>23.6–24.0</td>
</tr>
<tr class="odd">
<td><strong>Black</strong></td>
<td><strong>28.1 kg/m²</strong></td>
<td>28.0–28.4</td>
</tr>
<tr class="even">
<td><strong>Chinese</strong></td>
<td><strong>26.9 kg/m²</strong></td>
<td>26.7–27.2</td>
</tr>
<tr class="odd">
<td><strong>Arab</strong></td>
<td><strong>26.6 kg/m²</strong></td>
<td>26.5–27.0</td>
</tr>
</tbody>
</table>
<p><strong>Key teaching point:</strong><br>
A BMI of 30 kg/m² does <strong>not</strong> represent the same metabolic risk across all ethnicities.<br>
For some groups (notably South Asian and Chinese populations), clinically relevant risk<br>
appears at <strong>much lower BMI values</strong>.</p>
<p><em>Source:</em><br>
Caleyachetty R. et al.&nbsp;<em>Lancet Diabetes &amp; Endocrinology</em> 2021;9:419–26.</p>
<p>In the code below we:</p>
<ol type="1">
<li>Start from continuous BMI.<br>
</li>
<li>Create three broad categories using <code>pd.cut</code>.<br>
</li>
<li>Compare the summary of the original BMI distribution with the counts in each category.</li>
</ol>
<p>This is purely <strong>illustrative</strong> – it shows how easy it is to throw away information. In later weeks, we will discuss when categorisation might be useful and when it is better to keep BMI continuous (or use other measures such as waist circumference).</p>
<section id="visual-example-same-bmi-different-body-composition" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="visual-example-same-bmi-different-body-composition"><span class="header-section-number">3.2.1</span> 3.1.1 Visual example: same BMI, different body composition</h4>
<p>BMI cannot distinguish between <strong>fat mass</strong> and <strong>muscle mass</strong>.</p>
<p>In the illustration below, both individuals have (hypothetically) the <strong>same BMI</strong>, but very different body composition:</p>
<ul>
<li>one predominantly muscular,</li>
<li>one with higher body fat.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../_assets/bmi_same_bmi_diff_bodyshape.png" class="img-fluid figure-img"></p>
<figcaption>Two individuals with identical BMI but different body composition</figcaption>
</figure>
</div>
<p>This is why BMI is useful as a <strong>crude screening tool</strong>, but not a perfect measure of adiposity in individuals.</p>
<div id="bmi-categories-example" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.1 Example: collapsing continuous BMI into categories</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"BMI"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    bmi <span class="op">=</span> df[<span class="st">"BMI"</span>].copy()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Very simple categories for illustration only</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    bmi_cat <span class="op">=</span> pd.cut(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        bmi,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">30</span>, np.inf],</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>[<span class="st">"normal"</span>, <span class="st">"overweight"</span>, <span class="st">"obese"</span>],</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        right<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Original BMI (continuous) summary:"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    display(bmi.describe())</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">BMI categories (illustrative):"</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(bmi_cat.value_counts(dropna<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="self-reported-height-and-weight" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="self-reported-height-and-weight"><span class="header-section-number">3.2.2</span> 3.2 Self-reported height and weight</h4>
<p>Many large studies (including some national surveys) use <strong>self-reported</strong> height and weight instead of measured values.</p>
<p>Typical patterns:</p>
<ul>
<li>People tend to <strong>over-report height</strong>.</li>
<li>People tend to <strong>under-report weight</strong>.</li>
<li>The bias is not random – it often depends on sex, age, and actual body size.</li>
</ul>
<p>Consequences:</p>
<ul>
<li>BMI from self-report is usually <strong>biased downwards</strong>.</li>
<li>Misclassification across BMI categories (normal / overweight / obese) is common.</li>
<li>Associations between BMI and health outcomes can be <strong>biased</strong> if we ignore this measurement error.</li>
</ul>
<p>For teaching purposes, it is helpful to remember that:</p>
<blockquote class="blockquote">
<p>BMI combines two measured variables (height, weight)<br>
and those measurements themselves may be biased.</p>
</blockquote>
</section>
</section>
</section>
<section id="identifying-implausible-or-inconsistent-values" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="identifying-implausible-or-inconsistent-values"><span class="header-section-number">4</span> 4. Identifying implausible or inconsistent values</h2>
<p>Even carefully collected data may contain values that are <em>implausible</em> or <em>wrong</em>. Examples include:</p>
<ul>
<li>Anthropometric values outside physiological limits (for example, BMI &lt; 10 kg/m²).</li>
<li>Blood pressure values that are extremely low or high.</li>
<li>Energy intakes that are incompatible with life over the long term.</li>
<li>Men who are recorded as being “post-menopausal”.</li>
</ul>
<p>In practice we define <strong>simple rules</strong> to flag such values for review, and in some cases to exclude them from analysis.</p>
<div id="impl-bmi" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.1 Example: BMI range check</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># These cut-offs are illustrative. In a real study they should be</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># chosen with clinical input and clear documentation.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"BMI"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Summary of BMI:"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    display(df[<span class="st">"BMI"</span>].describe())</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    implausible_bmi <span class="op">=</span> df[(df[<span class="st">"BMI"</span>] <span class="op">&lt;</span> <span class="dv">10</span>) <span class="op">|</span> (df[<span class="st">"BMI"</span>] <span class="op">&gt;</span> <span class="dv">70</span>)]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of participants with BMI &lt; 10 or &gt; 70: </span><span class="sc">{</span><span class="bu">len</span>(implausible_bmi)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    display(implausible_bmi.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bp-check" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.2 Example: SBP (systolic blood pressure) range check</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"SBP"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Summary of SBP:"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    display(df[<span class="st">"SBP"</span>].describe())</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    implausible_sbp <span class="op">=</span> df[(df[<span class="st">"SBP"</span>] <span class="op">&lt;</span> <span class="dv">70</span>) <span class="op">|</span> (df[<span class="st">"SBP"</span>] <span class="op">&gt;</span> <span class="dv">260</span>)]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of participants with SBP &lt; 70 or &gt; 260 mmHg: </span><span class="sc">{</span><span class="bu">len</span>(implausible_sbp)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    display(implausible_sbp.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bmi-hist" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.3 Distribution of BMI – visual check</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"BMI"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"BMI"</span>].hist(bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"BMI (kg/m²)"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Number of participants"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Distribution of BMI – initial check"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="energy-intake-plausibility-and-the-goldberg-cut-off" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="energy-intake-plausibility-and-the-goldberg-cut-off"><span class="header-section-number">4.1</span> 4.4 Energy Intake Plausibility and the Goldberg Cut-off</h3>
<p>In nutritional epidemiology, a recurring question is whether <strong>reported energy intake (EI)</strong> is compatible with the <strong>energy a person is expected to expend</strong>.<br>
The <strong>Goldberg cut-off</strong> is a widely used, reproducible approach to detect <em>implausible</em> self-reported energy intakes.</p>
<section id="core-idea" class="level4" data-number="4.1.1">
<h4 data-number="4.1.1" class="anchored" data-anchor-id="core-idea"><span class="header-section-number">4.1.1</span> 1. Core idea</h4>
<p>The method compares:</p>
<p><span class="math display">\[
\frac{\text{EI}}{\text{EE}}
\]</span></p>
<p>where <strong>EE</strong> is the <em>minimum</em> energy expenditure expected for that person.</p>
<p>If the ratio is <em>too low</em>, the individual is likely to be an <strong>under-reporter</strong>.</p>
</section>
<section id="steps-in-the-goldberg-method" class="level4" data-number="4.1.2">
<h4 data-number="4.1.2" class="anchored" data-anchor-id="steps-in-the-goldberg-method"><span class="header-section-number">4.1.2</span> 2. Steps in the Goldberg method</h4>
<ol type="1">
<li><strong>Estimate Basal Metabolic Rate (BMR)</strong><br>
Usually via predictive equations (Schofield, Henry, or similar) using:
<ul>
<li>age<br>
</li>
<li>sex<br>
</li>
<li>weight (and occasionally height)</li>
</ul></li>
<li><strong>Assume a minimum plausible Physical Activity Level (PAL)</strong><br>
A typical assumption is <strong>PAL = 1.55</strong> for a “sedentary to lightly active” lifestyle.<br>
This gives the minimum Total Energy Expenditure (TEE):</li>
</ol>
<p><span class="math display">\[
   \text{TEE}_{\min} = \text{BMR} \times \text{PAL}
\]</span></p>
<ol start="3" type="1">
<li><strong>Compute the Goldberg ratio</strong></li>
</ol>
<p><span class="math display">\[
   r = \frac{\text{Reported EI}}{\text{TEE}_{\min}}
\]</span></p>
<ol start="4" type="1">
<li><p><strong>Compare the ratio to a cut-off</strong></p>
<p>A common lower limit is <strong>0.76–0.80</strong>, derived by combining:</p>
<ul>
<li>day-to-day variation in energy intake,</li>
<li>variation in BMR prediction,</li>
<li>sampling duration.</li>
</ul>
<p>If <span class="math display">\[ r &lt; \text{cut-off} \]</span>, the intake is considered <strong>implausibly low</strong>.</p></li>
</ol>
</section>
<section id="interpretation" class="level4" data-number="4.1.3">
<h4 data-number="4.1.3" class="anchored" data-anchor-id="interpretation"><span class="header-section-number">4.1.3</span> 3. Interpretation</h4>
<p>The rule does <em>not</em> say the individual is deliberately misreporting.<br>
It indicates that the <strong>reported intake is statistically incompatible</strong> with sustaining basic physiological requirements over time.</p>
<p>Examples: - A reported EI of <strong>900 kcal/day</strong> for a healthy adult is implausible.<br>
- A physically active person reporting 1,200 kcal/day may also be flagged.</p>
</section>
<section id="why-the-goldberg-cut-off-is-widely-used" class="level4" data-number="4.1.4">
<h4 data-number="4.1.4" class="anchored" data-anchor-id="why-the-goldberg-cut-off-is-widely-used"><span class="header-section-number">4.1.4</span> 4. Why the Goldberg cut-off is widely used</h4>
<ul>
<li><strong>Transparent</strong> and fully formula-based.<br>
</li>
<li><strong>Simple</strong> and implementable in any dataset.<br>
</li>
<li><strong>Consistent</strong> across studies.<br>
</li>
<li>Helps identify <strong>outliers</strong> before modelling.</li>
</ul>
<p>However, the method is designed for population-level plausibility screening, <strong>not</strong> as a diagnostic tool for individual behaviour.</p>
<hr>
</section>
</section>
<section id="limitations-of-the-goldberg-cut-off" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="limitations-of-the-goldberg-cut-off"><span class="header-section-number">4.2</span> 4.5 Limitations of the Goldberg Cut-off</h3>
<p>Although influential, the Goldberg approach has important limitations:</p>
<section id="a-strong-assumptions-about-pal" class="level4" data-number="4.2.1">
<h4 data-number="4.2.1" class="anchored" data-anchor-id="a-strong-assumptions-about-pal"><span class="header-section-number">4.2.1</span> (a) Strong assumptions about PAL</h4>
<p>Using a fixed PAL (for example 1.55) ignores the wide variation in physical activity between individuals.<br>
TEE may be substantially higher or lower than assumed, causing: - <em>false positives</em> (flagged as under-reporting but plausible),<br>
- <em>false negatives</em> (severe under-reporting may not be flagged if activity is low).</p>
</section>
<section id="b-bmr-prediction-error" class="level4" data-number="4.2.2">
<h4 data-number="4.2.2" class="anchored" data-anchor-id="b-bmr-prediction-error"><span class="header-section-number">4.2.2</span> (b) BMR prediction error</h4>
<p>Predictive equations for BMR introduce error: - ±5–10% for many individuals, - larger for those with atypical body composition.</p>
<p>If BMR is misestimated, the Goldberg ratio becomes misleading.</p>
</section>
<section id="c-one-day-or-few-day-intake-is-not-habitual-intake" class="level4" data-number="4.2.3">
<h4 data-number="4.2.3" class="anchored" data-anchor-id="c-one-day-or-few-day-intake-is-not-habitual-intake"><span class="header-section-number">4.2.3</span> (c) One-day (or few-day) intake is <strong>not</strong> habitual intake</h4>
<p>Short-term 24-h recalls show <strong>large day-to-day variation</strong>, making the ratio unstable.</p>
</section>
<section id="d-cannot-distinguish-intentional-dieting" class="level4" data-number="4.2.4">
<h4 data-number="4.2.4" class="anchored" data-anchor-id="d-cannot-distinguish-intentional-dieting"><span class="header-section-number">4.2.4</span> (d) Cannot distinguish <em>intentional dieting</em></h4>
<p>Low reported intakes may reflect: - short-term restriction, - illness, - poor recall, - dieting behaviour.</p>
<p>The cut-off treats all as “implausible”.</p>
</section>
<section id="e-systematic-bias-in-self-reporting" class="level4" data-number="4.2.5">
<h4 data-number="4.2.5" class="anchored" data-anchor-id="e-systematic-bias-in-self-reporting"><span class="header-section-number">4.2.5</span> (e) Systematic bias in self-reporting</h4>
<p>Energy misreporting is <strong>not random</strong>: - overweight individuals tend to under-report energy, especially snacks and high-fat foods; - some demographic groups systematically under- or over-report.</p>
<p>Thus the Goldberg decision can itself <strong>introduce bias</strong>, for example: - removing more participants with high BMI, - altering diet–BMI or diet–disease associations.</p>
<p>This concern is highlighted in recent evaluation studies.</p>
<hr>
</section>
</section>
<section id="recent-evidence-and-critique" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="recent-evidence-and-critique"><span class="header-section-number">4.3</span> 4.6 Recent evidence and critique</h3>
<p>A recent paper in <em>Nature Food</em> <a href="https://www.nature.com/articles/s43016-024-01089-5">Bajunaid et al., 2025</a> <strong>“Energy intake and expenditure in doubly labelled water studies worldwide”</strong><br>
provides an updated perspective:</p>
<ul>
<li>Doubly labelled water (DLW) studies show <strong>large inter-individual variation in TEE</strong>, wider than commonly assumed in Goldberg calculations.</li>
<li>Habitual EI is often <strong>higher than self-reported</strong>, but misreporting varies by age, sex, BMI and cultural context.</li>
<li>The study stresses that <strong>physiological variation is larger</strong> than the Goldberg framework assumes.</li>
<li>Therefore, using a universal PAL and narrow cut-offs may systematically misclassify valid data.</li>
</ul>
<p>This supports a broader consensus that:</p>
<blockquote class="blockquote">
<p>The Goldberg cut-off is useful as a descriptive tool,<br>
but insufficient for high-stakes decisions (for example, excluding participants).</p>
</blockquote>
<hr>
</section>
<section id="takeaway-2" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="takeaway-2"><span class="header-section-number">4.4</span> Takeaway</h3>
<p>The Goldberg cut-off is a <strong>useful first-pass plausibility screen</strong>, but:</p>
<ul>
<li>it rests on strong assumptions,</li>
<li>it is sensitive to prediction error,</li>
<li>and it can introduce bias if used uncritically.</li>
</ul>
<p>Modern datasets—with diverse populations, high variation in physical activity, and systematic misreporting—require <strong>more nuanced approaches</strong>, ideally supported by validation studies (for example, DLW data).</p>
<p>In FB2NEP we therefore use the Goldberg principle to illustrate:</p>
<ul>
<li>how plausibility checks work,</li>
<li>where modelling decisions come from,</li>
<li>and why epidemiological analyses require transparent assumptions.</li>
</ul>
<div id="energy-simple" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.5 Simple exploration of energy intake</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"energy_kcal"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Summary of reported energy intake (kcal/d):"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    display(df[<span class="st">"energy_kcal"</span>].describe())</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"energy_kcal"</span>].hist(bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Energy intake (kcal/day)"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Number of participants"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Distribution of reported energy intake"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plausibility-and-scale-hippo-vs-mouse-energy-intake" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="plausibility-and-scale-hippo-vs-mouse-energy-intake"><span class="header-section-number">5</span> 4.5 Plausibility and scale: hippo vs mouse energy intake</h2>
<p>Think of <strong>reported energy intake</strong>:</p>
<ul>
<li>A very small human reporting 15 000 kcal/day is <em>hippo-level</em> – probably implausible.</li>
<li>A large human reporting 600 kcal/day <em>long term</em> is <em>mouse-level</em> – probably implausible too.</li>
</ul>
<p>The FB2NEP dataset includes <code>energy_kcal</code>. When we look at its distribution we will:</p>
<ul>
<li>check whether values lie in a broadly plausible human range, and<br>
</li>
<li>remember that even plausible values can still be under- or over-reported.</li>
</ul>
<p>Later, you will encounter the <strong>Goldberg cut-off</strong>, which formalises this idea by comparing reported intake with estimated energy requirements.</p>
</section>
<section id="rare-categories-and-prefer-not-to-say" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="rare-categories-and-prefer-not-to-say"><span class="header-section-number">6</span> 5. Rare categories and “Prefer not to say”</h2>
<p>Questionnaires often include categories such as <strong>“Prefer not to say”</strong> or very rare responses. These raise practical questions:</p>
<ul>
<li>Should they be combined with another category?</li>
<li>Should they be treated as missing data?</li>
<li>Do they indicate a problem with the question (for example, perceived sensitivity)?</li>
</ul>
<p>Some patterns can be <strong>red flags</strong>:</p>
<ul>
<li>A question that is <em>consistently skipped</em> (many missing values) compared with others.<br>
→ Possible misunderstanding, poor wording, or discomfort with the topic.</li>
<li>A single participant who answers “Prefer not to say” to almost everything.<br>
→ Possible disengagement; their data may be low quality overall.</li>
<li>Systematic non-response to certain topics (for example, income, alcohol).<br>
→ Missingness may be <strong>MNAR</strong> and needs careful handling.</li>
</ul>
<section id="test-questions-and-internal-consistency" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="test-questions-and-internal-consistency"><span class="header-section-number">6.1</span> 5.1 Test questions and internal consistency</h3>
<p>Some questionnaires include one or two <strong>test questions</strong> to check whether participants are paying attention. Typical examples are:</p>
<ul>
<li>“To show that you are paying attention, please select <strong>‘strongly agree’</strong> for this statement.”<br>
</li>
<li>“For this question only, please tick <strong>‘never’</strong>.”<br>
</li>
<li>“The colour of the sky on a clear day is… (please tick <strong>‘blue’</strong>).”</li>
</ul>
<p>Other examples are factual statements about well-known places such as:</p>
<ul>
<li>“Wasilla, Alaska is in the continental United States — please select ‘Strongly disagree’.”</li>
<li>“Barrow, Alaska never receives snow — please select ‘Disagree’.”</li>
</ul>
<p>These items are widely used in survey-methods teaching because the correct answer is obvious, yet respondents who are not reading the questions carefully will fail them.</p>
<p>If participants fail these items, their responses might be low quality.</p>
<ul>
<li>This is common in <strong>online surveys</strong> and panel studies.</li>
<li>In large <strong>epidemiological cohorts</strong> the practice is less standard, but the <em>idea</em> is similar: we want to detect obviously invalid or careless data.</li>
</ul>
<p>Instead of explicit test questions, cohort studies often rely on <strong>internal consistency checks</strong>, for example:</p>
<ul>
<li>A participant reporting <strong>“never drinks alcohol”</strong> but also giving detailed answers about<br>
number of <strong>glasses of wine per week</strong> and <strong>maximum units on one occasion</strong>.<br>
</li>
<li>Reporting <strong>0 minutes of physical activity per week</strong>, but also stating that they <strong>cycle to work every day</strong>.<br>
</li>
<li>Marking <strong>“current smoker”</strong> and <strong>“has never smoked regularly”</strong> on different pages.<br>
</li>
<li>A male participant answering <strong>“post-menopausal”</strong> or reporting <strong>age at menopause</strong>.</li>
</ul>
<p>FB2NEP does not include explicit test questions, but you can treat these kinds of <em>internal contradictions</em> as serving a similar purpose: they flag records that may need closer inspection or, in some analyses, exclusion.</p>
<div id="rare-values-code" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.2 Simple frequency tables for key categorical variables</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"sex"</span>, <span class="st">"SES_class"</span>, <span class="st">"smoking_status"</span>, <span class="st">"physical_activity"</span>]:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Value counts for </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(df[col].value_counts(dropna<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="missing-data-mcar-mar-mnar-overview" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="missing-data-mcar-mar-mnar-overview"><span class="header-section-number">7</span> 6. Missing data: MCAR, MAR, MNAR (overview)</h2>
<p>Almost all real datasets contain missing values. Three concepts are important:</p>
<ul>
<li><strong>MCAR (Missing Completely At Random)</strong>:
<ul>
<li>The probability of missingness is unrelated to observed or unobserved data.</li>
<li>Example: a random sample of blood tubes is lost in the post.</li>
</ul></li>
<li><strong>MAR (Missing At Random)</strong>:
<ul>
<li>The probability of missingness depends only on observed variables.</li>
<li>Example: older participants are less likely to provide a urine sample, but age is recorded.</li>
</ul></li>
<li><strong>MNAR (Missing Not At Random)</strong>:
<ul>
<li>The probability of missingness depends on unobserved values.</li>
<li>Example: participants with very high alcohol intake are less likely to report their intake.</li>
</ul></li>
</ul>
<p>In the synthetic dataset we have:</p>
<ul>
<li>MCAR-type missingness on some biomarker and diet variables.</li>
<li>MAR-type missingness depending on age and deprivation.</li>
<li>Small MNAR components for alcohol and BMI.</li>
</ul>
<p>We start by computing the proportion missing in each variable.</p>
<div id="missing-fraction" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.1 Proportion of missing values in each variable</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>missing_fraction <span class="op">=</span> df.isna().mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>missing_fraction.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="missing-barplot" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.2 Visualising missingness for the top 25 variables</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>missing_fraction.head(<span class="dv">25</span>).plot(kind<span class="op">=</span><span class="st">"bar"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Proportion missing"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Proportion of missing values (top 25 variables)"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bmi-missing-age" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.3 Example: does missing BMI depend on age?</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> {<span class="st">"BMI"</span>, <span class="st">"age"</span>}.issubset(df.columns):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"BMI_missing"</span>] <span class="op">=</span> df[<span class="st">"BMI"</span>].isna()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Age distribution by BMI missingness:"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    display(df.groupby(<span class="st">"BMI_missing"</span>)[<span class="st">"age"</span>].describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="mar-imd" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.4 Example: does missing fruit_veg_g_d depend on IMD_quintile? (MAR pattern)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> {<span class="st">"fruit_veg_g_d"</span>, <span class="st">"IMD_quintile"</span>}.issubset(df.columns):</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"FV_missing"</span>] <span class="op">=</span> df[<span class="st">"fruit_veg_g_d"</span>].isna()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    tab <span class="op">=</span> pd.crosstab(df[<span class="st">"IMD_quintile"</span>], df[<span class="st">"FV_missing"</span>], normalize<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Proportion missing fruit_veg_g_d by IMD_quintile:"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    display(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-validation-checks" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="simple-validation-checks"><span class="header-section-number">8</span> 7. Simple validation checks</h2>
<p>Finally we perform a few simple validation checks:</p>
<ul>
<li>Are there any men with a non-“NA” menopausal status?</li>
<li>Do key variables have reasonable distributions by sex or SES?</li>
<li>Are any obvious coding errors visible when we group by categories?</li>
</ul>
<p>These checks will inform later modelling decisions.</p>
<div id="validate-meno" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.1 Check that menopausal_status is only set for women</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> {<span class="st">"sex"</span>, <span class="st">"menopausal_status"</span>}.issubset(df.columns):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    inconsistent <span class="op">=</span> df[(df[<span class="st">"sex"</span>] <span class="op">==</span> <span class="st">"M"</span>) <span class="op">&amp;</span> (df[<span class="st">"menopausal_status"</span>] <span class="op">!=</span> <span class="st">"NA"</span>)]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of men with non-NA menopausal_status: </span><span class="sc">{</span><span class="bu">len</span>(inconsistent)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    display(inconsistent.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="validate-bp-sex" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.2 Check SBP distribution by sex</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> {<span class="st">"SBP"</span>, <span class="st">"sex"</span>}.issubset(df.columns):</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"SBP by sex:"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    display(df.groupby(<span class="st">"sex"</span>)[<span class="st">"SBP"</span>].describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="summary"><span class="header-section-number">9</span> 8. Summary</h2>
<ul>
<li>We distinguished between <strong>continuous</strong>, <strong>categorical</strong>, <strong>ordinal</strong>, and <strong>count</strong> variables, and saw how they are stored and summarised in Python.</li>
<li>We discussed how <strong>coding</strong> (for example, collapsing BMI or SES) always involves some <strong>loss of information</strong>, which must be balanced against simplicity.</li>
<li>We outlined typical <strong>data collection pipelines</strong> in nutritional epidemiology and highlighted the importance of units and harmonisation across data sources.</li>
<li>We used simple <strong>plausibility checks</strong> to flag extreme values for BMI, SBP, and energy intake, and introduced the idea behind the <strong>Goldberg cut-off</strong>.</li>
<li>We explored <strong>rare categories</strong>, “Prefer not to say”, and the idea of <strong>test questions</strong> and internal consistency.</li>
<li>We introduced the concepts of <strong>MCAR</strong>, <strong>MAR</strong> and <strong>MNAR</strong> missingness and examined missing patterns for selected variables.</li>
<li>We performed a few <strong>validation checks</strong> (for example, menopausal status in men) to illustrate how coding errors can be detected early.</li>
</ul>
<p>These steps are part of routine data cleaning in nutritional epidemiology and prepare the ground for later workbooks on sampling, representativeness, and modelling.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ggkuhnle\.github\.io\/fb2nep-epi\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© University of Reading 2025 · Licensed <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ggkuhnle/fb2nep-epi/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ggkuhnle/fb2nep-epi/blob/main/notebooks/1.04_data_collection_cleaning.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with Quarto</p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>